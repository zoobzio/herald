---
title: Providers Reference
description: Provider-by-provider API reference.
author: Herald Team
published: 2025-12-06
tags: [Reference, Providers, API]
---

# Providers Reference

API reference for all herald providers.

---

## Kafka

```go
import "github.com/zoobzio/herald/kafka"
```

### Constructor

```go
func New(topic string, opts ...Option) *Provider
```

### Options

| Function | Description |
|----------|-------------|
| `WithWriter(w Writer)` | Kafka writer for publishing |
| `WithReader(r Reader)` | Kafka reader for subscribing |

### Interfaces

```go
// Writer defines the interface for Kafka message production.
type Writer interface {
    WriteMessages(ctx context.Context, msgs ...kafka.Message) error
    Close() error
}

// Reader defines the interface for Kafka message consumption.
type Reader interface {
    FetchMessage(ctx context.Context) (kafka.Message, error)
    CommitMessages(ctx context.Context, msgs ...kafka.Message) error
    Close() error
}
```

### Example

```go
import (
    "github.com/segmentio/kafka-go"
    heraldkafka "github.com/zoobzio/herald/kafka"
)

// Publishing
writer := &kafka.Writer{
    Addr:     kafka.TCP("localhost:9092"),
    Topic:    "orders",
    Balancer: &kafka.LeastBytes{},
}

// Subscribing
reader := kafka.NewReader(kafka.ReaderConfig{
    Brokers: []string{"localhost:9092"},
    Topic:   "orders",
    GroupID: "order-service",
})

provider := heraldkafka.New("orders",
    heraldkafka.WithWriter(writer),
    heraldkafka.WithReader(reader),
)
defer provider.Close()
```

### Metadata

Mapped to `[]kafka.Header`. Header keys and values are preserved.

---

## NATS

```go
import "github.com/zoobzio/herald/nats"
```

### Constructor

```go
func New(subject string, opts ...Option) *Provider
```

### Options

| Function | Description |
|----------|-------------|
| `WithConn(c Conn)` | NATS connection for publishing |
| `WithSubscriber(s Subscriber)` | NATS subscriber for consuming |

### Interfaces

```go
// Conn defines the interface for NATS message production.
type Conn interface {
    Publish(subject string, data []byte) error
    Close()
}

// Subscriber defines the interface for creating NATS subscriptions.
type Subscriber interface {
    Subscribe(subject string) (Subscription, error)
}

// Subscription defines the interface for NATS message consumption.
type Subscription interface {
    NextMsg(ctx context.Context) (Msg, error)
    Unsubscribe() error
}

// Msg represents a NATS message with acknowledgment support.
type Msg interface {
    Data() []byte
    Ack() error
    Nak() error
}
```

### Example

```go
import (
    "github.com/nats-io/nats.go"
    heraldnats "github.com/zoobzio/herald/nats"
)

nc, _ := nats.Connect("nats://localhost:4222")

// Wrap with adapters implementing the interfaces
provider := heraldnats.New("orders",
    heraldnats.WithConn(connAdapter{nc}),
    heraldnats.WithSubscriber(subAdapter{nc}),
)
defer provider.Close()
```

### Metadata

**Not supported** - NATS core does not support headers. Use JetStream for header support.

---

## Google Pub/Sub

```go
import "github.com/zoobzio/herald/pubsub"
```

### Constructor

```go
func New(opts ...Option) *Provider
```

### Options

| Function | Description |
|----------|-------------|
| `WithTopic(t Topic)` | Pub/Sub topic for publishing |
| `WithSubscription(s Subscription)` | Pub/Sub subscription for consuming |

### Interfaces

```go
// Topic defines the interface for Pub/Sub message production.
type Topic interface {
    Publish(ctx context.Context, data []byte, attributes map[string]string) error
    Stop()
}

// Subscription defines the interface for Pub/Sub message consumption.
type Subscription interface {
    Receive(ctx context.Context, handler func(ctx context.Context, msg Msg)) error
}

// Msg represents a Pub/Sub message with acknowledgment support.
type Msg interface {
    Data() []byte
    Attributes() map[string]string
    Ack()
    Nack()
}
```

### Example

```go
import (
    "cloud.google.com/go/pubsub"
    heraldpubsub "github.com/zoobzio/herald/pubsub"
)

client, _ := pubsub.NewClient(ctx, "my-project")

provider := heraldpubsub.New(
    heraldpubsub.WithTopic(topicAdapter{client.Topic("orders")}),
    heraldpubsub.WithSubscription(subAdapter{client.Subscription("orders-sub")}),
)
defer provider.Close()
```

### Metadata

Mapped to `Attributes` map.

---

## Redis Streams

```go
import "github.com/zoobzio/herald/redis"
```

### Constructor

```go
func New(stream string, opts ...Option) *Provider
```

### Options

| Function | Description |
|----------|-------------|
| `WithClient(c Client)` | Redis client |
| `WithGroup(group string)` | Consumer group for acknowledgment |

### Interfaces

```go
// Client defines the interface for Redis Streams operations.
type Client interface {
    XAdd(ctx context.Context, stream string, values map[string]any) error
    XRead(ctx context.Context, stream string, lastID string) ([]Message, error)
    XAck(ctx context.Context, stream, group, id string) error
    Close() error
}

// Message represents a Redis Stream message.
type Message struct {
    ID     string
    Data   []byte
    Fields map[string]string
}
```

### Example

```go
import (
    "github.com/redis/go-redis/v9"
    heraldredis "github.com/zoobzio/herald/redis"
)

rdb := redis.NewClient(&redis.Options{Addr: "localhost:6379"})

provider := heraldredis.New("orders-stream",
    heraldredis.WithClient(clientAdapter{rdb}),
    heraldredis.WithGroup("order-group"),
)
defer provider.Close()
```

### Metadata

Stored as additional stream fields alongside `data`.

---

## AWS SQS

```go
import "github.com/zoobzio/herald/sqs"
```

### Constructor

```go
func New(queueURL string, opts ...Option) *Provider
```

### Options

| Function | Description |
|----------|-------------|
| `WithClient(c Client)` | SQS client |

### Interfaces

```go
// Client defines the interface for SQS operations.
type Client interface {
    SendMessage(ctx context.Context, queueURL string, body string, attributes map[string]string) error
    ReceiveMessages(ctx context.Context, queueURL string) ([]Message, error)
    DeleteMessage(ctx context.Context, queueURL string, receiptHandle string) error
}

// Message represents an SQS message.
type Message struct {
    Body          string
    ReceiptHandle string
    Attributes    map[string]string
}
```

### Example

```go
import (
    "github.com/aws/aws-sdk-go-v2/service/sqs"
    heraldsqs "github.com/zoobzio/herald/sqs"
)

cfg, _ := config.LoadDefaultConfig(ctx)
sqsClient := sqs.NewFromConfig(cfg)

provider := heraldsqs.New(
    "https://sqs.us-east-1.amazonaws.com/123456789/orders",
    heraldsqs.WithClient(clientAdapter{sqsClient}),
)
defer provider.Close()
```

### Metadata

Mapped to `MessageAttributes`.

---

## RabbitMQ/AMQP

```go
import "github.com/zoobzio/herald/amqp"
```

### Constructor

```go
func New(queue string, opts ...Option) *Provider
```

### Options

| Function | Description |
|----------|-------------|
| `WithChannel(ch Channel)` | AMQP channel |
| `WithExchange(exchange string)` | Exchange name for publishing |
| `WithRoutingKey(key string)` | Routing key for publishing |

### Interfaces

```go
// Channel defines the interface for AMQP channel operations.
type Channel interface {
    Publish(exchange, key string, mandatory, immediate bool, body []byte, headers map[string]any) error
    Consume(queue, consumer string, autoAck, exclusive, noLocal, noWait bool) (<-chan Delivery, error)
    Close() error
}

// Delivery represents an AMQP message delivery.
type Delivery interface {
    Body() []byte
    Headers() map[string]any
    Ack(multiple bool) error
    Nack(multiple, requeue bool) error
}
```

### Example

```go
import (
    amqp "github.com/rabbitmq/amqp091-go"
    heraldamqp "github.com/zoobzio/herald/amqp"
)

conn, _ := amqp.Dial("amqp://guest:guest@localhost:5672/")
ch, _ := conn.Channel()

provider := heraldamqp.New("orders-queue",
    heraldamqp.WithChannel(channelAdapter{ch}),
    heraldamqp.WithExchange("orders-exchange"),
    heraldamqp.WithRoutingKey("order.created"),
)
defer provider.Close()
```

### Metadata

Mapped to `Headers` table. Only string values are preserved.

---

## AWS SNS

```go
import "github.com/zoobzio/herald/sns"
```

### Constructor

```go
func New(topicARN string, opts ...Option) *Provider
```

### Options

| Function | Description |
|----------|-------------|
| `WithClient(c Client)` | SNS client |

### Interfaces

```go
// Client defines the interface for SNS operations.
type Client interface {
    Publish(ctx context.Context, topicARN string, message string, attributes map[string]string) error
}
```

### Example

```go
import (
    "github.com/aws/aws-sdk-go-v2/service/sns"
    heraldsns "github.com/zoobzio/herald/sns"
)

cfg, _ := config.LoadDefaultConfig(ctx)
snsClient := sns.NewFromConfig(cfg)

provider := heraldsns.New(
    "arn:aws:sns:us-east-1:123456789:orders",
    heraldsns.WithClient(clientAdapter{snsClient}),
)
defer provider.Close()
```

### Notes

**Publish only** - Subscribe returns a closed channel. Use SQS with an SNS subscription for consuming messages.

### Metadata

Mapped to `MessageAttributes`.

---

## SQL

```go
import "github.com/zoobzio/herald/sql"
```

### Constructor

```go
func New(topic string, opts ...Option) *Provider
```

### Options

| Function | Description |
|----------|-------------|
| `WithDB(db DB)` | Database connection |
| `WithPollInterval(d time.Duration)` | How often to poll (default: 100ms) |
| `WithBatchSize(n int)` | Messages per poll (default: 10) |

### Interfaces

```go
// DB defines the interface for SQL database operations.
type DB interface {
    Insert(ctx context.Context, topic string, data []byte, metadata map[string]string) error
    Fetch(ctx context.Context, topic string, limit int) ([]Message, error)
    Delete(ctx context.Context, id string) error
    Close() error
}

// Message represents a row in the messages table.
type Message struct {
    ID       string
    Data     []byte
    Metadata map[string]string
}
```

### Example

```go
import (
    "database/sql"
    _ "github.com/lib/pq"
    heraldsql "github.com/zoobzio/herald/sql"
)

db, _ := sql.Open("postgres", "postgres://localhost/mydb")

provider := heraldsql.New("orders",
    heraldsql.WithDB(dbAdapter{db}),
    heraldsql.WithPollInterval(500 * time.Millisecond),
    heraldsql.WithBatchSize(20),
)
defer provider.Close()
```

### Metadata

Stored as a separate column (typically JSONB or TEXT).

---

## BoltDB

```go
import "github.com/zoobzio/herald/bolt"
```

### Constructor

```go
func New(bucket string, opts ...Option) *Provider
```

### Options

| Function | Description |
|----------|-------------|
| `WithDB(db DB)` | BoltDB connection |
| `WithPollInterval(d time.Duration)` | How often to poll (default: 100ms) |
| `WithBatchSize(n int)` | Messages per poll (default: 10) |

### Interfaces

```go
// DB defines the interface for BoltDB operations.
type DB interface {
    Put(bucket string, data []byte) (uint64, error)
    Scan(bucket string, limit int) ([]Message, error)
    Delete(bucket string, key uint64) error
    Close() error
}

// Message represents a key-value entry in BoltDB.
type Message struct {
    Key  uint64
    Data []byte
}
```

### Example

```go
import (
    "go.etcd.io/bbolt"
    heraldbolt "github.com/zoobzio/herald/bolt"
)

db, _ := bbolt.Open("mydb.bolt", 0600, nil)

provider := heraldbolt.New("orders",
    heraldbolt.WithDB(dbAdapter{db}),
    heraldbolt.WithPollInterval(100 * time.Millisecond),
)
defer provider.Close()
```

### Metadata

**Not supported** - BoltDB stores raw bytes only.

---

## Firestore

```go
import "github.com/zoobzio/herald/firestore"
```

### Constructor

```go
func New(collection string, opts ...Option) *Provider
```

### Options

| Function | Description |
|----------|-------------|
| `WithClient(c Client)` | Firestore client |

### Interfaces

```go
// Client defines the interface for Firestore operations.
type Client interface {
    Add(ctx context.Context, collection string, data []byte, metadata map[string]string) (string, error)
    Subscribe(ctx context.Context, collection string) (<-chan Document, error)
    Delete(ctx context.Context, collection, docID string) error
    Close() error
}

// Document represents a Firestore document.
type Document struct {
    ID       string
    Data     []byte
    Metadata map[string]string
}
```

### Example

```go
import (
    "cloud.google.com/go/firestore"
    heraldfirestore "github.com/zoobzio/herald/firestore"
)

client, _ := firestore.NewClient(ctx, "my-project")

provider := heraldfirestore.New("messages",
    heraldfirestore.WithClient(clientAdapter{client}),
)
defer provider.Close()
```

### Metadata

Stored as document fields.

---

## io

```go
import "github.com/zoobzio/herald/io"
```

### Constructor

```go
func New(opts ...Option) *Provider
```

### Options

| Function | Description |
|----------|-------------|
| `WithReader(r io.Reader)` | Reader for subscribing |
| `WithWriter(w io.Writer)` | Writer for publishing |
| `WithDelimiter(d byte)` | Message delimiter (default: newline) |

### Example

```go
import (
    "strings"
    heraldio "github.com/zoobzio/herald/io"
)

// Reader only
input := strings.NewReader(`{"id":"1"}` + "\n" + `{"id":"2"}` + "\n")
provider := heraldio.New(heraldio.WithReader(input))

// Writer only
var buf strings.Builder
provider := heraldio.New(heraldio.WithWriter(&buf))

// Combined
pr, pw := io.Pipe()
provider := heraldio.New(
    heraldio.WithReader(pr),
    heraldio.WithWriter(pw),
)
```

### Notes

- Newline-delimited by default (configurable via `WithDelimiter`)
- Ack/Nack are no-ops (data is consumed/written immediately)
- Useful for testing and CLI piping

### Metadata

**Not supported** - io streams carry raw bytes only.

---

## Provider Interface

All providers implement:

```go
type Provider interface {
    Publish(ctx context.Context, data []byte, metadata Metadata) error
    Subscribe(ctx context.Context) <-chan Result[Message]
    Close() error
}
```

## Interface Adapters

Providers define their own interfaces to avoid direct dependencies on vendor SDKs. You must create adapters to bridge vendor types to herald interfaces. This design:

- Allows testing with mocks
- Avoids vendor lock-in
- Keeps herald dependencies minimal

### Example Adapter

```go
// Adapter for kafka-go Writer
type kafkaWriterAdapter struct {
    w *kafka.Writer
}

func (a kafkaWriterAdapter) WriteMessages(ctx context.Context, msgs ...kafka.Message) error {
    return a.w.WriteMessages(ctx, msgs...)
}

func (a kafkaWriterAdapter) Close() error {
    return a.w.Close()
}

// Usage
writer := &kafka.Writer{...}
provider := heraldkafka.New("orders",
    heraldkafka.WithWriter(kafkaWriterAdapter{writer}),
)
```

## See Also

- [Providers Guide](../3.guides/2.providers.md) - Usage patterns
- [API Reference](./1.api.md) - Core API
